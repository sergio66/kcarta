
Introduction
-------------

kcmix is a matlab package to calculate high resolution mixed
absorptions and radiances from compressed tabulated absorptions.  
It is the mother of all matlab kcartas and also of the rtp format,
and remains relevant as a sanity check for performance and design
of subsequent versions.

A key idea is that the profile should define the set of mixed paths.
kcmix does 3-d interpolation in pressure, temperature, and partial
pressure to the user-supplied layer set, and radiance calculations
are done on user-supplied layers.

kcmix is from 2002.  The only changes for the initial 2014 git repo
are this README, the demo script ktest1.m, and the consolidation of
some notes and email in the doc subdirectory.


Top Level Routines
-------------------

kcrad - radiative transfer top-level wrapper, manages defaults and
        loops on chunks, calling kcmix2, contcalc, and rtchunk

rtchunk - radiative transfer calc's in 10^4 point chunks, including
          reflected solar and basic reflected thermal

kcmix2 - calculates 25 1/cm chunks of mixed absorptions for a
         supplied profile, from tabulated compressed absorptions

kcmix100 - version of kcmix that assumes a 100-layer input profile
           with the same layers as the reference profiles

contcalc - continuum calculation from kcarta tabulated values


Performance
------------

Code for the mixed absorptions has been tested against the Fortran
kcarta and line-by-line codes.  The code for radiance calculations
is newer and has not be tested as much, for example reflected solar
is not working.

Runtime performance is good.  Recent benchmarks with ktest1.m from
605 to 2805 1/cm with 44 gasses, reflected solar, reflected thermal,
and the version '24' of the water continuum code took 83 seconds on
a maya cluster node.  A top level breakdown of runtimes had

  kcmix2    51 pct
  rtchunk   35 pct
  contcalc  13 pct

Interpolation is less than 1 pct of kcmix runtime, and calculation
of interpolation weights even less, because we are interpolating the
compact representation.  The most time consuming lines in kcmix2 are

  29 pct, load tabulated coefficients
  23 pct, apply the decompression transform
  10 pct, check for existance of the coefficient file

The rest is spread around, mostly in find statements, dividing out
by the reference profile, and so on.  Except possibly for the load
there is isn't much left to optimize.


Data
-----

kcmix uses compressed tabulated optical depths.  The optical depths
are generated from GENLN2 or other line-by-line codes.  Code to do
this compression is in the abscmp subdirectory, see the README there
for an overview.


Test Routines
--------------

ktest1 - new demo and benchmark

ktest3 - compare kcmix and kcmix100 at varying layer sets

ktest5 - compare 100 layer single gas absorptions from kcmix and the
         new kcarta (v 1.07)

ktest6 - compare 100 layer single gas absorptions from kcmix, the new
         kcarta (v 1.07), and sergio's lbl code

ktest7 - test kcmix constituent amount and partial pressure calculations

ktest8 - test kcmix with old and new klayers

ktest9 - basic kcrad tests

ktest10 - demo of a call to kcrad followed by a convolution


Documentation
--------------

Documentation is sparse.  The top level routines have man-page style
comments, and the doc directory has some early email discussions and
a few miscellaneous notes.


Authors
--------

All kcmix code is by H. Motteler, with guidance for the radiative
transfer calculations from Sergio DeSouza-Machado and Scott Hannon.
L. Larrabee Strow is Principal Investigator, and we all contributed
to the fundamental ideas and initial development.

